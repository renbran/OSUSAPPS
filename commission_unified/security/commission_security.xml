<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <!-- Commission Management Groups -->
        <record id="group_commission_manager" model="res.groups">
            <field name="name">Commission Manager</field>
            <field name="category_id" ref="base.module_category_sales"/>
            <field name="comment">Full access to commission management including approval, configuration, and payment processing</field>
            <field name="implied_ids" eval="[(4, ref('sales_team.group_sale_manager'))]"/>
        </record>

        <record id="group_commission_user" model="res.groups">
            <field name="name">Commission User</field>
            <field name="category_id" ref="base.module_category_sales"/>
            <field name="comment">Limited access to commission management - can view and create commissions but cannot approve or process payments</field>
            <field name="implied_ids" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
        </record>

        <record id="group_commission_viewer" model="res.groups">
            <field name="name">Commission Viewer</field>
            <field name="category_id" ref="base.module_category_sales"/>
            <field name="comment">Read-only access to commission data for reporting and analysis</field>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Record Rules for Commission Lines -->
        <record id="commission_lines_rule_manager" model="ir.rule">
            <field name="name">Commission Lines: Manager Access</field>
            <field name="model_id" ref="model_commission_lines"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="commission_lines_rule_user" model="ir.rule">
            <field name="name">Commission Lines: User Access</field>
            <field name="model_id" ref="model_commission_lines"/>
            <field name="domain_force">[
                '|',
                ('sales_person_id', '=', user.id),
                ('sale_order_id.user_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_commission_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="commission_lines_rule_viewer" model="ir.rule">
            <field name="name">Commission Lines: Viewer Access</field>
            <field name="model_id" ref="model_commission_lines"/>
            <field name="domain_force">[
                '|',
                ('sales_person_id', '=', user.id),
                ('sale_order_id.user_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_commission_viewer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Record Rules for Sale Orders with Commissions -->
        <record id="sale_order_commission_rule_user" model="ir.rule">
            <field name="name">Sale Order Commission: User Access</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="domain_force">[
                '|',
                ('user_id', '=', user.id),
                ('commission_ids.sales_person_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_commission_user')), (4, ref('group_commission_viewer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Field-level Security -->
        <record id="commission_approval_fields_manager_only" model="ir.model.fields.selection">
            <field name="field_id" ref="base.field_sale_order__commission_status"/>
            <field name="value">approved</field>
            <field name="sequence">30</field>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
        </record>

        <record id="commission_payment_fields_manager_only" model="ir.model.fields.selection">
            <field name="field_id" ref="base.field_sale_order__commission_status"/>
            <field name="value">paid</field>
            <field name="sequence">50</field>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
        </record>

        <!-- Commission Configuration Access -->
        <record id="commission_config_manager_only" model="ir.rule">
            <field name="name">Commission Configuration: Manager Only</field>
            <field name="model_id" ref="base.model_ir_config_parameter"/>
            <field name="domain_force">[('key', 'not like', 'commission.%')]</field>
            <field name="groups" eval="[(4, ref('group_commission_user')), (4, ref('group_commission_viewer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Commission Manager can access commission config parameters -->
        <record id="commission_config_manager_access" model="ir.rule">
            <field name="name">Commission Configuration: Manager Access</field>
            <field name="model_id" ref="base.model_ir_config_parameter"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Commission Rules Security -->
        <record id="commission_rules_rule_manager" model="ir.rule">
            <field name="name">Commission Rules: Manager Access</field>
            <field name="model_id" ref="model_commission_rules"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="commission_rules_rule_user" model="ir.rule">
            <field name="name">Commission Rules: User Access</field>
            <field name="model_id" ref="model_commission_rules"/>
            <field name="domain_force">[
                '|',
                ('sales_person_ids', '=', False),
                ('sales_person_ids', 'in', [user.id])
            ]</field>
            <field name="groups" eval="[(4, ref('group_commission_user')), (4, ref('group_commission_viewer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Commission Calculator Security -->
        <record id="commission_calculator_rule_all" model="ir.rule">
            <field name="name">Commission Calculator: All Access</field>
            <field name="model_id" ref="model_commission_calculator"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_manager')), (4, ref('group_commission_user'))]"/>
        </record>

        <!-- Commission Payment Processor Security -->
        <record id="commission_payment_processor_rule_manager" model="ir.rule">
            <field name="name">Commission Payment Processor: Manager Only</field>
            <field name="model_id" ref="model_commission_payment_processor"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
        </record>

        <!-- Commission Workflow Security -->
        <record id="commission_workflow_rule_all" model="ir.rule">
            <field name="name">Commission Workflow: All Access</field>
            <field name="model_id" ref="model_commission_workflow"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_manager')), (4, ref('group_commission_user'))]"/>
        </record>

        <!-- Commission Product Rule Security -->
        <record id="commission_product_rule_security" model="ir.rule">
            <field name="name">Commission Product Rules: Manager Only</field>
            <field name="model_id" ref="model_commission_product_rule"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
        </record>

        <!-- Commission Discount Rule Security -->
        <record id="commission_discount_rule_security" model="ir.rule">
            <field name="name">Commission Discount Rules: Manager Only</field>
            <field name="model_id" ref="model_commission_discount_rule"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
        </record>

        <!-- Enhanced Field-level Security -->
        <record id="commission_status_approved_manager_only" model="ir.model.fields">
            <field name="name">status</field>
            <field name="model_id" ref="model_commission_lines"/>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
            <field name="readonly" eval="True"/>
        </record>

        <!-- Payment Method Restrictions -->
        <record id="commission_payment_method_manager" model="ir.model.fields">
            <field name="name">payment_method</field>
            <field name="model_id" ref="model_commission_lines"/>
            <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
        </record>

        <!-- Multi-company Rules -->
        <record id="commission_lines_company_rule" model="ir.rule">
            <field name="name">Commission Lines: Multi-company</field>
            <field name="model_id" ref="model_commission_lines"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('base.group_multi_company'))]"/>
        </record>

        <record id="commission_rules_company_rule" model="ir.rule">
            <field name="name">Commission Rules: Multi-company</field>
            <field name="model_id" ref="model_commission_rules"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('base.group_multi_company'))]"/>
        </record>

        <!-- Commission Amount Limits -->
        <record id="commission_amount_limit_user" model="ir.rule">
            <field name="name">Commission Lines: Amount Limit for Users</field>
            <field name="model_id" ref="model_commission_lines"/>
            <field name="domain_force">[('commission_amount', '&lt;=', 10000)]</field>
            <field name="groups" eval="[(4, ref('group_commission_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

    </data>
</odoo>