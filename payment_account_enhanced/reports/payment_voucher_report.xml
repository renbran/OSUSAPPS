<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Paper Format for Payment Voucher -->
        <record id="paperformat_voucher_a4" model="report.paperformat">
            <field name="name">Payment Voucher A4</field>
            <field name="default" eval="False"/>
            <field name="format">A4</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">15</field>
            <field name="margin_bottom">15</field>
            <field name="margin_left">15</field>
            <field name="margin_right">15</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">0</field>
            <field name="dpi">96</field>
        </record>

        <!-- Payment Voucher Report Action -->
        <record id="action_report_payment_voucher" model="ir.actions.report">
            <field name="name">Payment Voucher</field>
            <field name="model">account.payment</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">payment_account_enhanced.payment_voucher_template</field>
            <field name="report_file">payment_account_enhanced.payment_voucher_template</field>
            <field name="binding_model_id" ref="account.model_account_payment"/>
            <field name="binding_type">report</field>
            <field name="paperformat_id" ref="payment_account_enhanced.paperformat_voucher_a4"/>
        </record>

        <!-- Alternative ID for backward compatibility -->
        <record id="payment_voucher_report" model="ir.actions.report">
            <field name="name">Payment Voucher Report</field>
            <field name="model">account.payment</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">payment_account_enhanced.payment_voucher_template</field>
            <field name="report_file">payment_account_enhanced.payment_voucher_template</field>
            <field name="binding_model_id" ref="account.model_account_payment"/>
            <field name="binding_type">report</field>
            <field name="paperformat_id" ref="payment_account_enhanced.paperformat_voucher_a4"/>
        </record>

        <!-- Payment Voucher Template -->
        <template id="payment_voucher_template">
            <t t-call="web.html_container">
                <!-- Inline CSS Styles for the Payment Voucher -->
                <style>
                    .o_payment_voucher_container {
                        font-family: Arial, sans-serif;
                        color: #333;
                        line-height: 1.5;
                    }
                    .o_payment_voucher_container table {
                        width: 100%;
                        border-collapse: collapse;
                    }
                    .o_payment_voucher_container th {
                        text-align: left;
                        padding: 8px;
                        background-color: #f8f9fa;
                        border-bottom: 1px solid #ddd;
                    }
                    .o_payment_voucher_container td {
                        padding: 8px;
                        border-bottom: 1px solid #eee;
                    }
                    @media print {
                        .o_payment_voucher_container {
                            font-size: 12px;
                        }
                        .o_payment_signatures {
                            page-break-inside: avoid;
                        }
                    }
                </style>

                <t t-foreach="docs" t-as="payment">
                    <t t-call="web.external_layout">
                        <div class="page o_payment_voucher_container">
                            <!-- Header -->
                            <div class="o_payment_voucher_header" style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #2c3e50; padding-bottom: 15px;">
                                <h1 style="color: #2c3e50; margin: 0; font-size: 28px; font-weight: bold;">
                                    <span t-field="payment.company_id.name"/>
                                </h1>
                                <div style="color: #7f8c8d; font-size: 14px; margin-top: 5px;">
                                    <span t-field="payment.company_id.street"/>
                                    <span t-if="payment.company_id.street2">
                                        <span t-field="payment.company_id.street2"/>
                                    </span>
                                    <span t-field="payment.company_id.city"/>
                                    <span t-if="payment.company_id.state_id.name">
                                        <span t-field="payment.company_id.state_id.name"/>
                                    </span>
                                    <span t-field="payment.company_id.zip"/>
                                    <span t-if="payment.company_id.country_id.name">
                                        <span t-field="payment.company_id.country_id.name"/>
                                    </span>
                                </div>
                                <div style="color: #7f8c8d; font-size: 14px; margin-top: 3px;">
                                    <span t-if="payment.company_id.vat">
                                        VAT: <span t-field="payment.company_id.vat"/>
 |
                                    </span>
                                    <span t-if="payment.company_id.phone">
                                        📞                                        <span t-field="payment.company_id.phone"/>
 |
                                    </span>
                                    <span t-if="payment.company_id.email">
                                        📧                                        <span t-field="payment.company_id.email"/>
                                    </span>
                                </div>
                            </div>

                            <!-- Document Title and Reference -->
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h2 style="color: #2c3e50; margin: 0; font-size: 24px; font-weight: bold;">PAYMENT RECEIPT</h2>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold;">Ref: <span t-field="payment.name"/>
                                    </div>
                                    <div>Date: <span t-field="payment.date"/>
                                    </div>
                                </div>
                            </div>

                            <!-- Recipient Information -->
                            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                                <h3 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 16px;">ISSUED TO:</h3>
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%;">
                                            <strong>Name:</strong>
                                            <span t-field="payment.partner_id"/>
                                        </td>
                                        <td>
                                            <strong>Phone:</strong>
                                            <span t-if="payment.partner_id.phone">
                                                <span t-field="payment.partner_id.phone"/>
                                            </span>
                                            <span t-else="">N/A</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>Email:</strong>
                                            <span t-if="payment.partner_id.email">
                                                <span t-field="payment.partner_id.email"/>
                                            </span>
                                            <span t-else="">N/A</span>
                                        </td>
                                        <td>
                                            <strong>Payment Method:</strong>
                                            <span t-field="payment.journal_id"/>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Payment Details -->
                            <div style="margin-bottom: 25px;">
                                <h3 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 16px;">PAYMENT DETAILS</h3>
                                <table>
                                    <tr>
                                        <td style="width: 30%; font-weight: bold;">Transaction Type:</td>
                                        <td>
                                            <span t-field="payment.payment_type"/>
                                            <t t-if="payment.payment_type == 'inbound'">(Money Received)</t>
                                            <t t-elif="payment.payment_type == 'outbound'">(Money Sent)</t>
                                        </td>
                                    </tr>
                                    <tr t-if="payment.ref">
                                        <td style="font-weight: bold;">Reference:</td>
                                        <td>
                                            <span t-field="payment.ref"/>
                                        </td>
                                    </tr>
                                    <tr t-if="payment.narration">
                                        <td style="font-weight: bold;">Terms &amp; Conditions:</td>
                                        <td>
                                            <span t-field="payment.narration"/>
                                        </td>
                                    </tr>
                                    <tr t-if="payment.remarks">
                                        <td style="font-weight: bold;">Remarks:</td>
                                        <td>
                                            <span t-field="payment.remarks"/>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Amount Section -->
                            <div style="background-color: #e8f4fc; padding: 20px; border-radius: 5px; margin-bottom: 25px; text-align: center;">
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">
                                    TOTAL AMOUNT: <span t-field="payment.amount" t-options='{"widget": "monetary", "display_currency": payment.currency_id}'/>
                                </div>
                                <div style="font-style: italic; color: #2c3e50;">
                                    <span t-esc="payment.currency_id.amount_to_text(payment.amount)"/>
                                    <span t-field="payment.currency_id.name"/>
                                </div>
                            </div>

                            <!-- Payment Status -->
                            <div style="text-align: center; margin-bottom: 25px;">
                                <div style="display: inline-block; padding: 8px 20px; background-color: #27ae60; color: white; border-radius: 20px; font-weight: bold;">
                                    <t t-if="payment.state == 'posted'">Payment Completed</t>
                                    <t t-elif="payment.state == 'draft'">Payment Draft</t>
                                    <t t-elif="payment.state == 'cancelled'">Payment Cancelled</t>
                                    <t t-else="">
                                        <span t-field="payment.state"/>
                                    </t>
                                </div>
                            </div>

                            <!-- QR Code Section (Enhanced for verification) -->
                            <div t-if="payment.qr_code" style="text-align: center; margin-bottom: 25px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <div style="font-weight: bold; margin-bottom: 10px; color: #2c3e50; font-size: 14px;">
                                    Voucher Verification QR Code
                                </div>
                                <img t-att-src="image_data_uri(payment.qr_code)" style="max-width: 150px; border: 2px solid #3498db; padding: 8px; background: white; border-radius: 4px;"/>
                                <div style="font-size: 11px; color: #7f8c8d; margin-top: 8px; line-height: 1.4;">
                                    <div>Scan this QR code to verify the authenticity</div>
                                    <div>and approval status of this <span t-if="payment.payment_type == 'inbound'">receipt</span>
                                        <span t-if="payment.payment_type == 'outbound'">payment</span> voucher</div>
                                    <div style="margin-top: 5px; font-size: 10px; color: #95a5a6;">
                                        Voucher: <span t-field="payment.voucher_number"/>
                                    </div>
                                </div>
                            </div>

                            <!-- QR Code Fallback (if QR not generated) -->
                            <div t-if="not payment.qr_code and payment.access_token" style="text-align: center; margin-bottom: 25px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <div style="font-weight: bold; margin-bottom: 10px; color: #e74c3c; font-size: 14px;">
                                    QR Code Not Available
                                </div>
                                <div style="font-size: 11px; color: #7f8c8d; line-height: 1.4;">
                                    <div>Visit this URL to verify the voucher:</div>
                                    <div style="margin-top: 5px; font-family: monospace; background: white; padding: 5px; border: 1px solid #ddd; word-break: break-all; font-size: 9px;">
                                        <span t-esc="request.httprequest.url_root"/>
payment/verify/<span t-field="payment.access_token"/>
                                    </div>
                                </div>
                            </div>

                            <!-- Approval Workflow Section -->
                            <div t-if="payment.reviewer_id or payment.approver_id or payment.authorizer_id or payment.approval_history_ids" style="margin-bottom: 25px;">
                                <h3 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 16px;">APPROVAL WORKFLOW</h3>

                                <!-- Approval History Table -->
                                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background-color: #e9ecef;">
                                                <th style="padding: 10px; text-align: left; font-weight: bold; border-bottom: 2px solid #dee2e6;">Stage</th>
                                                <th style="padding: 10px; text-align: left; font-weight: bold; border-bottom: 2px solid #dee2e6;">Approved By</th>
                                                <th style="padding: 10px; text-align: left; font-weight: bold; border-bottom: 2px solid #dee2e6;">Date &amp; Time</th>
                                                <th style="padding: 10px; text-align: left; font-weight: bold; border-bottom: 2px solid #dee2e6;">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Created By -->
                                            <tr>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: bold;">1. Created</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.create_uid.name"/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.create_date" t-options='{"format": "dd/MM/yyyy HH:mm:ss"}'/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span style="background-color: #28a745; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">✓ COMPLETED</span>
                                                </td>
                                            </tr>

                                            <!-- Reviewed By -->
                                            <tr t-if="payment.reviewer_id">
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: bold;">2. Reviewed</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.reviewer_id.name"/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.reviewer_date" t-options='{"format": "dd/MM/yyyy HH:mm:ss"}'/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span style="background-color: #28a745; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">✓ COMPLETED</span>
                                                </td>
                                            </tr>

                                            <!-- Approved By -->
                                            <tr t-if="payment.approver_id">
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: bold;">3. Approved</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.approver_id.name"/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.approver_date" t-options='{"format": "dd/MM/yyyy HH:mm:ss"}'/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span style="background-color: #28a745; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">✓ COMPLETED</span>
                                                </td>
                                            </tr>

                                            <!-- Authorized By -->
                                            <tr t-if="payment.authorizer_id">
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: bold;">4. Authorized</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.authorizer_id.name"/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.authorizer_date" t-options='{"format": "dd/MM/yyyy HH:mm:ss"}'/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span style="background-color: #28a745; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">✓ COMPLETED</span>
                                                </td>
                                            </tr>

                                            <!-- Posted/Finalized -->
                                            <tr t-if="payment.state == 'posted'">
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: bold;">5. Posted</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.write_uid.name"/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span t-field="payment.write_date" t-options='{"format": "dd/MM/yyyy HH:mm:ss"}'/>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                    <span style="background-color: #007bff; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">✓ POSTED</span>
                                                </td>
                                            </tr>

                                            <!-- Additional History from approval_history_ids -->
                                            <t t-foreach="payment.approval_history_ids" t-as="history">
                                                <tr t-if="history.action_type in ['review', 'approve', 'authorize', 'verify']">
                                                    <td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: bold;">
                                                        <span t-field="history.action_type"/>
 -                                                        <span t-field="history.stage_to"/>
                                                    </td>
                                                    <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                        <span t-field="history.user_id.name"/>
                                                        <span t-if="history.comments" style="font-style: italic; color: #6c757d;">
                                                            <br/>
Comment: <span t-field="history.comments"/>
                                                        </span>
                                                    </td>
                                                    <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                        <span t-field="history.approval_date" t-options='{"format": "dd/MM/yyyy HH:mm:ss"}'/>
                                                    </td>
                                                    <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                                        <span style="background-color: #17a2b8; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">✓ LOGGED</span>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>

                                    <!-- Current Status Summary -->
                                    <div style="margin-top: 15px; padding: 10px; background-color: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 0 5px 5px 0;">
                                        <strong style="color: #1976d2;">Current Status: </strong>
                                        <span style="color: #1976d2; font-weight: bold; text-transform: uppercase;">
                                            <span t-field="payment.approval_state"/>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Signatures Section -->
                            <div style="margin-top: 40px; margin-bottom: 30px;">
                                <h4 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">AUTHORIZED SIGNATURES</h4>
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 33%; text-align: center; vertical-align: bottom;">
                                            <div style="height: 60px;"></div>
                                            <div style="border-top: 1px solid #333; padding-top: 5px; margin-bottom: 5px; width: 80%; margin-left: auto; margin-right: auto;"></div>
                                            <div style="font-weight: bold; font-size: 12px;">FINANCE DEPARTMENT</div>
                                            <div style="font-size: 10px; color: #7f8c8d;">Signature &amp; Date</div>
                                        </td>
                                        <td style="width: 33%; text-align: center; vertical-align: bottom;">
                                            <div style="height: 60px;"></div>
                                            <div style="border-top: 1px solid #333; padding-top: 5px; margin-bottom: 5px; width: 80%; margin-left: auto; margin-right: auto;"></div>
                                            <div style="font-weight: bold; font-size: 12px;">ACCOUNTS MANAGER</div>
                                            <div style="font-size: 10px; color: #7f8c8d;">Signature &amp; Date</div>
                                        </td>
                                        <td style="width: 33%; text-align: center; vertical-align: bottom;">
                                            <div style="height: 60px;"></div>
                                            <div style="border-top: 1px solid #333; padding-top: 5px; margin-bottom: 5px; width: 80%; margin-left: auto; margin-right: auto;"></div>
                                            <div style="font-weight: bold; font-size: 12px;">AUTHORIZED OFFICER</div>
                                            <div style="font-size: 10px; color: #7f8c8d;">Signature &amp; Date</div>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Footer -->
                            <div style="border-top: 1px solid #ddd; padding-top: 15px; text-align: center; font-size: 12px; color: #7f8c8d;">
                                <div style="margin-bottom: 5px;">
                                    Computer-generated document | <span t-field="payment.company_id.name"/>
                                </div>
                                <div>
                                    <span t-if="payment.company_id.phone">
                                        📞                                        <span t-field="payment.company_id.phone"/>
 |
                                    </span>
                                    <span t-if="payment.company_id.email">
                                        📧                                        <span t-field="payment.company_id.email"/>
 |
                                    </span>
                                    <span t-if="payment.company_id.website">
                                        🌐                                        <span t-field="payment.company_id.website"/>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>