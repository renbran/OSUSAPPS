<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Main Menu -->
    <record id="menu_partner_statement_followup_root" model="ir.ui.menu">
        <field name="name">Follow-up &amp; Statements</field>
        <field name="parent_id" ref="account.menu_finance"/>
        <field name="sequence">50</field>
    </record>

    <!-- Sub-menus -->
    <record id="menu_partners_followup" model="ir.ui.menu">
        <field name="name">Partners Follow-up</field>
        <field name="parent_id" ref="menu_partner_statement_followup_root"/>
        <field name="action" ref="action_partners_followup"/>
        <field name="sequence">10</field>
    </record>

    <record id="menu_batch_followup" model="ir.ui.menu">
        <field name="name">Batch Follow-up</field>
        <field name="parent_id" ref="menu_partner_statement_followup_root"/>
        <field name="action" ref="action_batch_followup_wizard"/>
        <field name="sequence">20</field>
    </record>

    <record id="menu_partner_statement" model="ir.ui.menu">
        <field name="name">Partner Statement</field>
        <field name="parent_id" ref="menu_partner_statement_followup_root"/>
        <field name="action" ref="action_statement_wizard"/>
        <field name="sequence">30</field>
    </record>

    <record id="menu_followup_history" model="ir.ui.menu">
        <field name="name">Follow-up History</field>
        <field name="parent_id" ref="menu_partner_statement_followup_root"/>
        <field name="action" ref="action_followup_history"/>
        <field name="sequence">40</field>
    </record>

    <!-- Configuration Menu -->
    <record id="menu_statement_config" model="ir.ui.menu">
        <field name="name">Configuration</field>
        <field name="parent_id" ref="menu_partner_statement_followup_root"/>
        <field name="sequence">100</field>
    </record>

    <record id="menu_statement_settings" model="ir.ui.menu">
        <field name="name">Statement Settings</field>
        <field name="parent_id" ref="menu_statement_config"/>
        <field name="action" ref="action_statement_config"/>
        <field name="sequence">10</field>
        <field name="groups" ref="group_statement_manager"/>
    </record>

    <!-- Dashboard Menu Items -->
    <record id="menu_ageing_analysis" model="ir.ui.menu">
        <field name="name">Ageing Analysis</field>
        <field name="parent_id" ref="menu_partner_statement_followup_root"/>
        <field name="action" ref="action_ageing_analysis"/>
        <field name="sequence">50</field>
    </record>

    <!-- Actions for Dashboard -->
    <record id="action_ageing_analysis" model="ir.actions.act_window">
        <field name="name">Ageing Analysis</field>
        <field name="res_model">account.move.line</field>
        <field name="view_mode">pivot,graph</field>
        <field name="domain">[('account_id.account_type', '=', 'asset_receivable'), ('reconciled', '=', False), ('amount_residual', '&gt;', 0)]</field>
        <field name="context">{
            'search_default_group_partner': 1,
            'search_default_group_ageing': 1,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No outstanding receivables found
            </p>
            <p>
                This view shows the ageing analysis of outstanding customer receivables.
            </p>
        </field>
    </record>

    <!-- Ageing Analysis Views -->
    <record id="view_account_move_line_ageing_pivot" model="ir.ui.view">
        <field name="name">account.move.line.ageing.pivot</field>
        <field name="model">account.move.line</field>
        <field name="arch" type="xml">
            <pivot string="Ageing Analysis">
                <field name="partner_id" type="row"/>
                <field name="ageing_bucket" type="col"/>
                <field name="amount_residual" type="measure"/>
            </pivot>
        </field>
    </record>

    <record id="view_account_move_line_ageing_graph" model="ir.ui.view">
        <field name="name">account.move.line.ageing.graph</field>
        <field name="model">account.move.line</field>
        <field name="arch" type="xml">
            <graph string="Ageing Analysis" type="bar">
                <field name="ageing_bucket"/>
                <field name="amount_residual" type="measure"/>
            </graph>
        </field>
    </record>

    <record id="view_account_move_line_ageing_search" model="ir.ui.view">
        <field name="name">account.move.line.ageing.search</field>
        <field name="model">account.move.line</field>
        <field name="inherit_id" ref="account.view_account_move_line_filter"/>
        <field name="arch" type="xml">
            <filter name="unreconciled" position="after">
                <separator/>
                <filter name="overdue" string="Overdue" domain="[('is_overdue', '=', True)]"/>
                <filter name="current" string="Current" domain="[('ageing_bucket', '=', 'current')]"/>
                <filter name="bucket_1_30" string="1-30 Days" domain="[('ageing_bucket', '=', '1_30')]"/>
                <filter name="bucket_31_60" string="31-60 Days" domain="[('ageing_bucket', '=', '31_60')]"/>
                <filter name="bucket_61_90" string="61-90 Days" domain="[('ageing_bucket', '=', '61_90')]"/>
                <filter name="bucket_90_plus" string="90+ Days" domain="[('ageing_bucket', '=', '90_plus')]"/>
            </filter>
            <group expand="0" string="Group By" position="inside">
                <filter name="group_ageing" string="Ageing Bucket" context="{'group_by': 'ageing_bucket'}"/>
                <filter name="group_overdue" string="Overdue Status" context="{'group_by': 'is_overdue'}"/>
            </group>
        </field>
    </record>

    <!-- Update ageing analysis action to use custom views -->
    <record id="action_ageing_analysis" model="ir.actions.act_window">
        <field name="view_ids" eval="[(5, 0, 0),
                                      (0, 0, {'view_mode': 'pivot', 'view_id': ref('view_account_move_line_ageing_pivot')}),
                                      (0, 0, {'view_mode': 'graph', 'view_id': ref('view_account_move_line_ageing_graph')})]"/>
        <field name="search_view_id" ref="view_account_move_line_ageing_search"/>
    </record>
</odoo>
