<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Deals Commission Report Template -->
        <template id="deals_commission_report_template" name="Comprehensive Deals Commission Report">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <style>
                                @page {
                                    margin: 10mm;
                                    size: A4 landscape;
                                }
                                
                                body {
                                    font-family: 'Arial', sans-serif;
                                    font-size: 10px;
                                    line-height: 1.3;
                                    color: #333;
                                }
                                
                                .report-header {
                                    text-align: center;
                                    margin-bottom: 20px;
                                    padding-bottom: 10px;
                                    border-bottom: 2px solid #800020;
                                }
                                
                                .report-title {
                                    font-size: 22px;
                                    font-weight: bold;
                                    color: #800020;
                                    margin: 0 0 8px 0;
                                }
                                
                                .report-subtitle {
                                    font-size: 12px;
                                    color: #666;
                                    margin: 0;
                                }
                                
                                .filter-info {
                                    background-color: #f8f9fa;
                                    padding: 10px;
                                    margin: 15px 0;
                                    border-radius: 4px;
                                    border-left: 4px solid #800020;
                                    font-size: 9px;
                                }
                                
                                .summary-stats {
                                    display: flex;
                                    justify-content: space-around;
                                    background-color: #e9ecef;
                                    padding: 10px;
                                    margin: 15px 0;
                                    border-radius: 4px;
                                    font-size: 9px;
                                }
                                
                                .summary-item {
                                    text-align: center;
                                    flex: 1;
                                }
                                
                                .summary-value {
                                    font-size: 14px;
                                    font-weight: bold;
                                    color: #800020;
                                }
                                
                                .deals-table {
                                    width: 100%;
                                    border-collapse: collapse;
                                    margin-top: 15px;
                                    font-size: 8px;
                                }
                                
                                .deals-table th {
                                    background-color: #800020;
                                    color: white;
                                    padding: 8px 4px;
                                    text-align: center;
                                    font-weight: bold;
                                    border: 1px solid #ddd;
                                    font-size: 8px;
                                }
                                
                                .deals-table td {
                                    padding: 6px 4px;
                                    text-align: left;
                                    border: 1px solid #ddd;
                                    vertical-align: top;
                                }
                                
                                .deals-table td.number {
                                    text-align: right;
                                }
                                
                                .deals-table td.center {
                                    text-align: center;
                                }
                                
                                .deals-table tr:nth-child(even) {
                                    background-color: #f9f9f9;
                                }
                                
                                .deals-table tr:hover {
                                    background-color: #f5f5f5;
                                }
                                
                                .project-group {
                                    background-color: #e9ecef;
                                    font-weight: bold;
                                    color: #495057;
                                }
                                
                                .status-eligible { color: #28a745; font-weight: bold; }
                                .status-processed { color: #17a2b8; font-weight: bold; }
                                .status-paid { color: #007bff; font-weight: bold; }
                                .status-pending { color: #ffc107; font-weight: bold; }
                                .status-cancelled { color: #dc3545; font-weight: bold; }
                                
                                .amount-positive { color: #28a745; }
                                .amount-zero { color: #6c757d; }
                                
                                @media print {
                                    .page-break { page-break-before: always; }
                                }
                            </style>

                            <!-- Report Header -->
                            <div class="report-header">
                                <h1 class="report-title">Comprehensive Deals Commission Report</h1>
                                <p class="report-subtitle">Complete overview of deals with commission details, payment status, and project information</p>
                            </div>

                            <!-- Filter Information -->
                            <div class="filter-info">
                                <strong>Report Filters:</strong>
                                <br/>
                                <span>
                                    <strong>Date Range:</strong>
                                    <t t-esc="data.get('date_from')"/>
 to <t t-esc="data.get('date_to')"/>
                                </span> |
                                <span>
                                    <strong>Partner:</strong>
                                    <t t-esc="data.get('partner_filter', 'All Partners')"/>
                                </span> |
                                <span>
                                    <strong>Project:</strong>
                                    <t t-esc="data.get('project_filter', 'All Projects')"/>
                                </span>
                                <br/>
                                <span>
                                    <strong>Generated on:</strong>
                                    <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M:%S')"/>
                                </span>
                            </div>

                            <!-- Summary Statistics -->
                            <div class="summary-stats">
                                <div class="summary-item">
                                    <div class="summary-value">
                                        <t t-esc="data.get('total_deals', 0)"/>
                                    </div>
                                    <div>Total Deals</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-value">
                                        <t t-esc="'{:,.2f}'.format(data.get('total_eligible_amount', 0))"/>
                                    </div>
                                    <div>Total Eligible Commission</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-value">
                                        <t t-esc="'{:,.2f}'.format(data.get('total_processed_amount', 0))"/>
                                    </div>
                                    <div>Total Processed</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-value">
                                        <t t-esc="'{:,.2f}'.format(data.get('total_paid_amount', 0))"/>
                                    </div>
                                    <div>Total Paid</div>
                                </div>
                            </div>

                            <!-- Deals Table -->
                            <table class="deals-table">
                                <thead>
                                    <tr>
                                        <th style="width: 8%;">Deal/Order</th>
                                        <th style="width: 10%;">Customer</th>
                                        <th style="width: 6%;">Booking Date</th>
                                        <th style="width: 8%;">Project</th>
                                        <th style="width: 8%;">Unit</th>
                                        <th style="width: 7%;">Order Amount</th>
                                        <th style="width: 9%;">Commission Partner</th>
                                        <th style="width: 6%;">Role</th>
                                        <th style="width: 5%;">Type</th>
                                        <th style="width: 4%;">Rate</th>
                                        <th style="width: 7%;">Eligible</th>
                                        <th style="width: 7%;">Processed</th>
                                        <th style="width: 7%;">Paid</th>
                                        <th style="width: 7%;">Pending</th>
                                        <th style="width: 7%;">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-set="current_project" t-value="None"/>
                                    <t t-foreach="data.get('deals_data', [])" t-as="deal">
                                        <!-- Project Group Header (if grouping by project) -->
                                        <t t-if="deal['project_name'] != current_project and o.group_by_project">
                                            <t t-set="current_project" t-value="deal['project_name']"/>
                                            <tr class="project-group">
                                                <td colspan="15">
                                                    <strong>Project: <t t-esc="deal['project_name']"/>
                                                    </strong>
                                                </td>
                                            </tr>
                                        </t>

                                        <!-- Deal Row -->
                                        <tr>
                                            <td>
                                                <t t-esc="deal['order_name']"/>
                                            </td>
                                            <td>
                                                <t t-esc="deal['customer_name']"/>
                                            </td>
                                            <td class="center">
                                                <t t-if="deal['booking_date']">
                                                    <t t-esc="deal['booking_date'].strftime('%Y-%m-%d') if deal['booking_date'] else ''"/>
                                                </t>
                                            </td>
                                            <td>
                                                <t t-esc="deal['project_name']"/>
                                            </td>
                                            <td>
                                                <t t-esc="deal['unit_reference']"/>
                                            </td>
                                            <td class="number">
                                                <t t-esc="deal['currency_symbol']"/>
                                                <t t-esc="'{:,.2f}'.format(deal['order_amount'])"/>
                                            </td>
                                            <td>
                                                <t t-esc="deal['partner_name']"/>
                                            </td>
                                            <td>
                                                <t t-esc="deal['commission_role']"/>
                                            </td>
                                            <td>
                                                <t t-esc="deal['commission_type']"/>
                                            </td>
                                            <td class="number">
                                                <t t-if="deal['commission_rate']">
                                                    <t t-esc="'{:.1f}%'.format(deal['commission_rate'])"/>
                                                </t>
                                            </td>
                                            <td class="number">
                                                <span t-attf-class="#{deal['eligible_amount'] > 0 and 'amount-positive' or 'amount-zero'}">
                                                    <t t-esc="deal['currency_symbol']"/>
                                                    <t t-esc="'{:,.2f}'.format(deal['eligible_amount'])"/>
                                                </span>
                                            </td>
                                            <td class="number">
                                                <span t-attf-class="#{deal['commission_processed'] > 0 and 'amount-positive' or 'amount-zero'}">
                                                    <t t-esc="deal['currency_symbol']"/>
                                                    <t t-esc="'{:,.2f}'.format(deal['commission_processed'])"/>
                                                </span>
                                            </td>
                                            <td class="number">
                                                <span t-attf-class="#{deal['commission_paid'] > 0 and 'amount-positive' or 'amount-zero'}">
                                                    <t t-esc="deal['currency_symbol']"/>
                                                    <t t-esc="'{:,.2f}'.format(deal['commission_paid'])"/>
                                                </span>
                                            </td>
                                            <td class="number">
                                                <span t-attf-class="#{deal['commission_pending'] > 0 and 'amount-positive' or 'amount-zero'}">
                                                    <t t-esc="deal['currency_symbol']"/>
                                                    <t t-esc="'{:,.2f}'.format(deal['commission_pending'])"/>
                                                </span>
                                            </td>
                                            <td class="center">
                                                <span t-attf-class="status-#{deal['commission_status'].lower()}">
                                                    <t t-esc="deal['commission_status']"/>
                                                </span>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>

                            <!-- Additional Details Section (if show_payment_details is enabled) -->
                            <t t-if="o.show_payment_details">
                                <div style="margin-top: 20px;">
                                    <h3 style="color: #800020; border-bottom: 1px solid #800020; padding-bottom: 5px;">Payment Details Summary</h3>
                                    <table class="deals-table" style="font-size: 9px;">
                                        <thead>
                                            <tr>
                                                <th>Deal/Order</th>
                                                <th>Order State</th>
                                                <th>Total Invoiced</th>
                                                <th>Total Paid</th>
                                                <th>Invoice Count</th>
                                                <th>Payment Count</th>
                                                <th>Outstanding</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="data.get('deals_data', [])" t-as="deal">
                                                <tr>
                                                    <td>
                                                        <t t-esc="deal['order_name']"/>
                                                    </td>
                                                    <td class="center">
                                                        <t t-esc="deal['state_display']"/>
                                                    </td>
                                                    <td class="number">
                                                        <t t-esc="deal['currency_symbol']"/>
                                                        <t t-esc="'{:,.2f}'.format(deal['total_invoiced'])"/>
                                                    </td>
                                                    <td class="number">
                                                        <t t-esc="deal['currency_symbol']"/>
                                                        <t t-esc="'{:,.2f}'.format(deal['total_paid'])"/>
                                                    </td>
                                                    <td class="center">
                                                        <t t-esc="deal['invoice_count']"/>
                                                    </td>
                                                    <td class="center">
                                                        <t t-esc="deal['payment_count']"/>
                                                    </td>
                                                    <td class="number">
                                                        <t t-esc="deal['currency_symbol']"/>
                                                        <t t-esc="'{:,.2f}'.format(deal['total_invoiced'] - deal['total_paid'])"/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </t>

                            <!-- Footer -->
                            <div style="margin-top: 30px; font-size: 8px; color: #6c757d; text-align: center; border-top: 1px solid #ddd; padding-top: 10px;">
                                <p>This report was generated automatically from the Commission Management System</p>
                                <p>For questions about commission calculations or payment status, please contact the Finance Department</p>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>

        <!-- Report Action -->
        <record id="action_report_deals_commission" model="ir.actions.report">
            <field name="name">Comprehensive Deals Commission Report</field>
            <field name="model">deals.commission.report.wizard</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">commission_ax.deals_commission_report_template</field>
            <field name="report_file">commission_ax.deals_commission_report_template</field>
            <field name="binding_model_id" ref="model_deals_commission_report_wizard"/>
            <field name="paperformat_id" ref="base.paperformat_euro"/>
            <field name="print_report_name">'Deals Commission Report - %s to %s' % (object.date_from, object.date_to)</field>
        </record>
    </data>
</odoo>
