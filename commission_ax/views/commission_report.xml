<?xml version="1.0"?>
<odoo>
    <data>
        <template id="commission_payout_report_template_enhanced">
            <t t-name="commission_ax.commission_report_document">
                <t t-call="web.html_container">
                    <t t-foreach="docs" t-as="o">
                        <t t-call="web.external_layout">
                            <div class="page">
                                <style>
                                    /* All CSS styles from your request */
                                    @page { margin: 6mm; size: A4; }
                                    .commission-container { font-family: 'Segoe UI', Arial, sans-serif; }
                                    /* ... (all other CSS styles) ... */
                                </style>

                                <div class="commission-container">
                                    <!-- Header Section -->
                                    <div class="commission-header">
                                        <div class="header-content">
                                            <div class="qr-section">
                                                <div class="qr-placeholder">QR</div>
                                                <div class="qr-label">Commission</div>
                                            </div>
                                            
                                            <div class="title-section">
                                                <h1 class="report-title">Commission Report</h1>
                                                <div class="report-subtitle">
                                                    Order: <strong><span t-field="o.name"/></strong> | 
                                                    Date: <strong><span t-field="o.date_order" t-options="{'widget': 'date'}"/></strong>
                                                </div>
                                            </div>
                                            
                                            <div class="company-info">
                                                <div class="company-name">OSUS Real Estate</div>
                                                <div>Business Bay, Dubai</div>
                                                <div>+971-4-366-4500</div>
                                                <div style="margin-top: 3px; font-size: 11px; color: #ffd700;">Professional Report</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Deal Information Section -->
                                    <div class="section-header">Deal Information</div>
                                    <div class="deal-info-grid">
                                        <div class="info-column">
                                            <div class="info-item">
                                                <div class="info-label">Customer:</div>
                                                <div class="info-value"><span t-field="o.partner_id.name"/></div>
                                            </div>
                                            <div class="info-item">
                                                <div class="info-label">Project:</div>
                                                <div class="info-value"><span t-field="o.project_id.name"/></div>
                                            </div>
                                            <div class="info-item">
                                                <div class="info-label">Unit:</div>
                                                <div class="info-value"><span t-field="o.unit_id.name"/></div>
                                            </div>
                                        </div>
                                        
                                        <div class="info-column">
                                            <div class="info-item">
                                                <div class="info-label">Order Total:</div>
                                                <div class="info-value highlight-value">
                                                    <t t-esc="'{:,.0f}'.format(o.amount_total or 0)"/>
                                                    <span t-field="o.currency_id.name"/>
                                                </div>
                                            </div>
                                            <div class="info-item">
                                                <div class="info-label">Currency:</div>
                                                <div class="info-value"><span t-field="o.currency_id.name"/></div>
                                            </div>
                                            <div class="info-item">
                                                <div class="info-label">Status:</div>
                                                <div class="info-value"><span t-field="o.state"/></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Unit Details Table -->
                                    <div class="section-header">Unit and Pricing Details</div>
                                    <table class="unit-table">
                                        <thead>
                                            <tr>
                                                <th style="width: 50%;">Description</th>
                                                <th style="width: 20%;">Unit Price</th>
                                                <th style="width: 15%;">Qty</th>
                                                <th style="width: 15%;">Subtotal</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="o.order_line" t-as="line">
                                                <tr>
                                                    <td><span t-field="line.product_id.name"/></td>
                                                    <td>
                                                        <t t-esc="'{:,.0f}'.format(line.price_unit or 0)"/>
                                                        <span t-field="o.currency_id.name"/>
                                                    </td>
                                                    <td><span t-field="line.product_uom_qty"/></td>
                                                    <td>
                                                        <t t-esc="'{:,.0f}'.format(line.price_subtotal or 0)"/>
                                                        <span t-field="o.currency_id.name"/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>

                                    <!-- Commission Breakdown Section -->
                                    <div class="section-header">Commission Breakdown</div>
                                    <div class="commission-grid">
                                        <!-- External Parties -->
                                        <div class="commission-box">
                                            <div class="box-title">External Parties</div>
                                            <div class="commission-content">
                                                <!-- Broker -->
                                                <t t-if="o.broker_partner_id">
                                                    <div class="commission-item">
                                                        <span class="commission-label">Broker:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:.1f}%'.format(o.broker_rate or 0)"/>
                                                        </span>
                                                    </div>
                                                    <div class="commission-item">
                                                        <span class="commission-label">Amount:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:,.0f}'.format(o.broker_amount or 0)"/>
                                                            <span t-field="o.currency_id.name"/>
                                                        </span>
                                                    </div>
                                                </t>
                                                
                                                <!-- Referrer -->
                                                <t t-if="o.referrer_partner_id">
                                                    <div class="commission-item">
                                                        <span class="commission-label">Referrer:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:.1f}%'.format(o.referrer_rate or 0)"/>
                                                        </span>
                                                    </div>
                                                    <div class="commission-item">
                                                        <span class="commission-label">Amount:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:,.0f}'.format(o.referrer_amount or 0)"/>
                                                            <span t-field="o.currency_id.name"/>
                                                        </span>
                                                    </div>
                                                </t>
                                                
                                                <!-- Cashback -->
                                                <t t-if="o.cashback_partner_id">
                                                    <div class="commission-item">
                                                        <span class="commission-label">Cashback:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:.1f}%'.format(o.cashback_rate or 0)"/>
                                                        </span>
                                                    </div>
                                                    <div class="commission-item">
                                                        <span class="commission-label">Amount:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:,.0f}'.format(o.cashback_amount or 0)"/>
                                                            <span t-field="o.currency_id.name"/>
                                                        </span>
                                                    </div>
                                                </t>
                                                
                                                <!-- Total External -->
                                                <div class="commission-item">
                                                    <span class="commission-label">Total External:</span>
                                                    <span class="commission-amount">
                                                        <t t-esc="'{:,.0f}'.format(o.total_external_commission_amount or 0)"/>
                                                        <span t-field="o.currency_id.name"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Internal Parties -->
                                        <div class="commission-box">
                                            <div class="box-title">Internal Parties</div>
                                            <div class="commission-content">
                                                <!-- Agent 1 -->
                                                <t t-if="o.agent1_partner_id">
                                                    <div class="commission-item">
                                                        <span class="commission-label">Agent 1:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:.1f}%'.format(o.agent1_rate or 0)"/>
                                                        </span>
                                                    </div>
                                                    <div class="commission-item">
                                                        <span class="commission-label">Amount:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:,.0f}'.format(o.agent1_amount or 0)"/>
                                                            <span t-field="o.currency_id.name"/>
                                                        </span>
                                                    </div>
                                                </t>
                                                
                                                <!-- Agent 2 -->
                                                <t t-if="o.agent2_partner_id">
                                                    <div class="commission-item">
                                                        <span class="commission-label">Agent 2:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:.1f}%'.format(o.agent2_rate or 0)"/>
                                                        </span>
                                                    </div>
                                                    <div class="commission-item">
                                                        <span class="commission-label">Amount:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:,.0f}'.format(o.agent2_amount or 0)"/>
                                                            <span t-field="o.currency_id.name"/>
                                                        </span>
                                                    </div>
                                                </t>
                                                
                                                <!-- Manager -->
                                                <t t-if="o.manager_partner_id">
                                                    <div class="commission-item">
                                                        <span class="commission-label">Manager:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:.1f}%'.format(o.manager_rate or 0)"/>
                                                        </span>
                                                    </div>
                                                    <div class="commission-item">
                                                        <span class="commission-label">Amount:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:,.0f}'.format(o.manager_amount or 0)"/>
                                                            <span t-field="o.currency_id.name"/>
                                                        </span>
                                                    </div>
                                                </t>
                                                
                                                <!-- Director -->
                                                <t t-if="o.director_partner_id">
                                                    <div class="commission-item">
                                                        <span class="commission-label">Director:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:.1f}%'.format(o.director_rate or 0)"/>
                                                        </span>
                                                    </div>
                                                    <div class="commission-item">
                                                        <span class="commission-label">Amount:</span>
                                                        <span class="commission-amount">
                                                            <t t-esc="'{:,.0f}'.format(o.director_amount or 0)"/>
                                                            <span t-field="o.currency_id.name"/>
                                                        </span>
                                                    </div>
                                                </t>
                                                
                                                <!-- Total Internal -->
                                                <div class="commission-item">
                                                    <span class="commission-label">Total Internal:</span>
                                                    <span class="commission-amount">
                                                        <t t-esc="'{:,.0f}'.format(o.total_internal_commission_amount or 0)"/>
                                                        <span t-field="o.currency_id.name"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Financial Summary -->
                                    <div class="totals-section">
                                        <div class="totals-title">Financial Summary</div>
                                        <div class="totals-grid">
                                            <div class="total-item">
                                                <div class="total-label">Order Total</div>
                                                <div class="total-amount">
                                                    <t t-esc="'{:,.0f}'.format(o.amount_total or 0)"/>
                                                    <span t-field="o.currency_id.name"/>
                                                </div>
                                            </div>
                                            <div class="total-item">
                                                <div class="total-label">Total Commissions</div>
                                                <div class="total-amount">
                                                    <t t-esc="'{:,.0f}'.format(o.total_commission_amount or 0)"/>
                                                    <span t-field="o.currency_id.name"/>
                                                </div>
                                            </div>
                                            <div class="total-item">
                                                <div class="total-label">Net Amount</div>
                                                <div class="total-amount">
                                                    <t t-esc="'{:,.0f}'.format((o.amount_total or 0) - (o.total_commission_amount or 0))"/>
                                                    <span t-field="o.currency_id.name"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Footer -->
                                    <div class="creator-info">
                                        Generated by: <strong><span t-field="o.create_uid.name"/></strong> on 
                                        <strong><span t-field="o.create_date" t-options="{'widget': 'datetime'}"/></strong>
                                    </div>
                                    
                                    <div class="footer-section">
                                        <div class="footer-title">Commission Report - Confidential Document</div>
                                        <div>This is a computer-generated commission report. All amounts are subject to verification and final approval.</div>
                                        <div style="font-size: 10px; margin-top: 3px; opacity: 0.8; color: #ffd700;">
                                            OSUS Real Estate Brokerage LLC | Dubai, UAE | License No: RERA-1234567
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>
                </t>
            </t>
        </template>

        <!-- Report Action -->
        <record id="report_commission_payout_enhanced" model="ir.actions.report">
            <field name="name">Commission Payout Report (Enhanced)</field>
            <field name="model">sale.order</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">commission_ax.commission_report_document</field>
            <field name="print_report_name">'Commission Report - %s' % object.name</field>
            <field name="paperformat_id" ref="base.paperformat_euro"/>
            <field name="binding_model_id" ref="sale.model_sale_order"/>
            <field name="binding_type">report</field>
        </record>
    </data>
</odoo>