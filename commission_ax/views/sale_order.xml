<?xml version="1.0"?>
<odoo>
    <data>
        <record id="view_order_form_inherit_commission_enhanced" model="ir.ui.view">
            <field name="name">sale.order.form.commission.enhanced</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header" position="inside">
                    <button name="action_process_commissions" type="object" string="Calculate Commissions" class="btn-primary" invisible="commission_status != 'draft'"/>
                    <button name="action_confirm_commissions" type="object" string="Confirm Commissions" class="btn-primary" invisible="commission_status != 'calculated'"/>
                    <button name="action_reset_commissions" type="object" string="Reset to Draft" invisible="commission_status == 'draft'"/>
                    <button name="action_batch_process_commissions" type="object" 
                        string="Batch Process" class="btn-primary" 
                        context="{'active_ids': active_ids}"/>
                </xpath>

                <xpath expr="//field[@name='client_order_ref']" position="after">
                    <field name="commission_status" widget="statusbar" statusbar_visible="draft,calculated,confirmed"/>
                </xpath>

                <xpath expr="//div[@name='button_box']" position="inside">
                    <button type="object" name="action_view_commission_pos" class="oe_stat_button" icon="fa-shopping-cart" invisible="purchase_order_count == 0">
                        <field name="purchase_order_count" widget="statinfo" string="Commission POs"/>
                        <div class="o_field_widget o_stat_info" style="padding-top: 4px;">
                            <span class="o_stat_value" style="font-size: 14px; color: #28a745;">
                                <field name="purchase_order_total_amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            </span>
                            <span class="o_stat_text" style="font-size: 11px;">Total Amount</span>
                        </div>
                    </button>
                </xpath>

                <xpath expr="//notebook" position="inside">
                    <page string="Commissions" name="commissions">
                        <group>
                            <group string="Commission Summary">
                                <field name="total_external_commission_amount" readonly="1"/>
                                <field name="total_internal_commission_amount" readonly="1"/>
                                <field name="total_commission_amount" readonly="1"/>
                                <field name="company_share" readonly="1"/>
                                <field name="net_company_share" readonly="1"/>
                            </group>
                            <group string="Commission Controls">
                                <field name="commission_processed" readonly="1"/>
                                <field name="purchase_order_count" string="Generated POs"/>
                                <field name="purchase_order_total_amount" string="Total PO Amount" readonly="1"/>
                            </group>
                        </group>

                        <notebook>
                            <!-- Tabs for External, Internal, and Legacy commissions -->
                            <!-- Each tab contains fields for commission configuration -->
                        </notebook>
                    </page>
                </xpath>
            </field>
        </record>
    </data>
        <!-- Tree (list) view for commissions -->
        <record id="sale_order_commission_tree" model="ir.ui.view">
            <field name="name">sale.order.commission.tree</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <tree string="Commission Orders" default_order="date_order desc">
                    <field name="name"/>
                    <field name="date_order"/>
                    <field name="partner_id"/>
                    <field name="commission_status"/>
                    <field name="total_commission_amount"/>
                    <field name="consultant_id"/>
                    <field name="manager_id"/>
                    <field name="director_id"/>
                    <field name="broker_partner_id"/>
                    <field name="purchase_order_count"/>
                </tree>
            </field>
        </record>

        <!-- Search view for commissions -->
        <record id="sale_order_commission_search" model="ir.ui.view">
            <field name="name">sale.order.commission.search</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <search string="Commission Search">
                    <field name="name"/>
                    <field name="commission_status" filter_domain="[]"/>
                    <field name="consultant_id"/>
                    <field name="manager_id"/>
                    <field name="director_id"/>
                    <field name="broker_partner_id"/>
                    <field name="date_order"/>
                </search>
            </field>
        </record>

        <!-- Action for commission list -->
        <record id="action_sale_order_commission_list" model="ir.actions.act_window">
            <field name="name">Commission Orders</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="view_ids" eval="[(5,0,0), (0,0,{'view_mode': 'tree', 'view_id': ref('sale_order_commission_tree')}), (0,0,{'view_mode': 'form', 'view_id': ref('view_order_form_inherit_commission_enhanced')})]"/>
            <field name="search_view_id" ref="sale_order_commission_search"/>
            <field name="domain">[("commission_status", "!=", False)]</field>
        </record>

        <!-- Menu item for commission orders -->
        <menuitem id="menu_sale_order_commission_list" name="Commission Orders" parent="sale.menu_sale_order" action="action_sale_order_commission_list" sequence="20"/>
    </data>
</odoo>