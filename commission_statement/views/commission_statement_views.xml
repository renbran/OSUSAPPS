<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Commission Statement Wizard Form View -->
        <record id="view_commission_statement_wizard_form" model="ir.ui.view">
            <field name="name">commission.statement.wizard.form</field>
            <field name="model">commission.statement.wizard</field>
            <field name="arch" type="xml">
                <form string="Commission Statement Report">
                    <sheet>
                        <div class="oe_title">
                            <h1>Commission Statement Report Generator</h1>
                            <p class="text-muted">Generate detailed commission statements in PDF or Excel format</p>
                        </div>
                        
                        <group>
                            <group string="Date Range">
                                <field name="date_from" required="1"/>
                                <field name="date_to" required="1"/>
                            </group>
                            <group string="Filters">
                                <field name="partner_id" options="{'no_create': True}"/>
                                <field name="sale_order_id" options="{'no_create': True}"/>
                                <field name="commission_type_filter"/>
                            </group>
                        </group>
                        
                        <group string="Report Options">
                            <group>
                                <field name="include_zero_commissions"/>
                                <field name="group_by_partner"/>
                            </group>
                            <group>
                                <field name="show_customer_details"/>
                            </group>
                        </group>
                    </sheet>
                    
                    <footer>
                        <button name="action_preview_data" 
                                string="Preview Data" 
                                type="object" 
                                class="btn-secondary"/>
                        <button name="action_generate_pdf_report" 
                                string="Generate PDF" 
                                type="object" 
                                class="btn-primary"/>
                        <button name="action_generate_excel_report" 
                                string="Generate Excel" 
                                type="object" 
                                class="btn-success"/>
                        <button string="Cancel" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Commission Statement Preview Form View -->
        <record id="view_commission_statement_preview_form" model="ir.ui.view">
            <field name="name">commission.statement.report.preview.form</field>
            <field name="model">commission.statement.report.preview</field>
            <field name="arch" type="xml">
                <form string="Commission Statement Preview">
                    <sheet>
                        <div class="oe_title">
                            <h1>Commission Statement Preview</h1>
                        </div>
                        
                        <group>
                            <group>
                                <field name="total_lines" readonly="1"/>
                                <field name="total_amount" readonly="1" widget="monetary"/>
                            </group>
                        </group>
                        
                        <notebook>
                            <page string="Commission Lines">
                                <field name="line_ids" nolabel="1">
                                    <tree>
                                        <field name="partner_name"/>
                                        <field name="order_ref"/>
                                        <field name="customer_ref"/>
                                        <field name="commission_type_display"/>
                                        <field name="rate"/>
                                        <field name="amount" widget="monetary"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    
                    <footer>
                        <button string="Close" class="btn-primary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Menu Items -->
        <!-- Main Commission Reports Menu -->
        <menuitem id="menu_commission_statement_reports" 
                  name="Commission Statement Reports" 
                  parent="sale.sale_menu_root" 
                  sequence="50"/>

        <!-- Action for Commission Statement Wizard -->
        <record id="action_commission_statement_wizard" model="ir.actions.act_window">
            <field name="name">Commission Statement Report</field>
            <field name="res_model">commission.statement.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="view_id" ref="view_commission_statement_wizard_form"/>
        </record>

        <!-- Commission Statement Report Menu -->
        <menuitem id="menu_commission_statement_report" 
                  name="Commission Statement Report" 
                  parent="menu_commission_statement_reports" 
                  action="action_commission_statement_wizard" 
                  sequence="10"/>

        <!-- Add smart button to Sale Order for quick access -->
        <record id="view_order_form_commission_statement_report_button" model="ir.ui.view">
            <field name="name">sale.order.form.commission.statement.report.button</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/sheet/div[@name='button_box']" position="inside">
                    <button name="action_open_commission_report_wizard" 
                            type="object" 
                            class="oe_stat_button" 
                            icon="fa-file-excel-o"
                            invisible="total_commission_amount == 0">
                        <div class="o_stat_info">
                            <span class="o_stat_text">Commission</span>
                            <span class="o_stat_text">Statement</span>
                        </div>
                    </button>
                </xpath>
            </field>
        </record>

        <!-- Commission Partners Filter Action -->
        <record id="action_commission_statement_partners" model="ir.actions.act_window">
            <field name="name">Commission Statement Partners</field>
            <field name="res_model">res.partner</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('id', 'in', [])]</field>
            <field name="context">{
                'search_default_commission_partners': 1,
                'default_supplier_rank': 1
            }</field>
        </record>

        <!-- Partner search view for commission partners -->
        <record id="view_partner_filter_commission" model="ir.ui.view">
            <field name="name">res.partner.search.commission</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_res_partner_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='supplier']" position="after">
                    <filter name="commission_partners" 
                            string="Commission Partners" 
                            domain="[('supplier_rank', '>', 0)]"
                            help="Partners who receive commissions"/>
                </xpath>
            </field>
        </record>

        <!-- Add Commission Partners menu -->
        <menuitem id="menu_commission_statement_partners" 
                  name="Commission Statement Partners" 
                  parent="menu_commission_statement_reports" 
                  action="action_commission_statement_partners" 
                  sequence="20"/>

        <!-- Menu Security -->
        <record id="menu_commission_statement_reports" model="ir.ui.menu">
            <field name="groups_id" eval="[(4, ref('group_commission_statement_user'))]"/>
        </record>

        <!-- Action Security -->
        <record id="action_commission_statement_wizard" model="ir.actions.act_window">
            <field name="groups_id" eval="[(4, ref('group_commission_statement_user'))]"/>
        </record>
    </data>
</odoo>