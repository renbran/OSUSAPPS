<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Commission Statement User Group -->
    <record id="group_commission_statement_user" model="res.groups">
        <field name="name">Commission Statement User</field>
        <field name="category_id" ref="base.module_category_sales"/>
        <field name="comment">Users can view and generate commission statements</field>
    </record>

    <!-- Commission Statement Manager Group -->
    <record id="group_commission_statement_manager" model="res.groups">
        <field name="name">Commission Statement Manager</field>
        <field name="category_id" ref="base.module_category_sales"/>
        <field name="implied_ids" eval="[(4, ref('group_commission_statement_user'))]"/>
        <field name="comment">Managers can configure commission statement settings and access all partner statements</field>
    </record>

    <!-- Email Template for Commission Statement -->
    <record id="email_template_commission_statement" model="mail.template">
        <field name="name">Commission Statement</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="subject">Commission Statement - ${object.name}</field>
        <field name="body_html" type="html">
            <div style="font-family: Arial, sans-serif; margin: 20px;">
                <h2 style="color: #2E86AB;">Commission Statement</h2>

                <p>Dear ${object.name},</p>

                <p>Please find attached your commission statement for the period.</p>

                <div style="background-color: #f8f9fa; padding: 15px; margin: 20px 0; border-left: 4px solid #2E86AB;">
                    <h4 style="margin: 0 0 10px 0;">Commission Summary:</h4>
                    <ul style="margin: 0;">
                        <li>
                            <strong>Total Commission Orders:</strong> ${object.commission_order_count}</li>
                        <li>
                            <strong>Total Commission Amount:</strong> ${format_amount(object.total_commission_amount, object.currency_id)}</li>
                        % if object.last_commission_date:
                        <li>
                            <strong>Last Commission Date:</strong> ${object.last_commission_date}</li>
                        % endif
                    </ul>
                </div>

                <p>If you have any questions regarding this statement, please don't hesitate to contact us.</p>

                <p>Best regards,<br/>
                ${user.name}<br/>
                ${user.company_id.name}</p>
        </div>
    </field>
    <field name="auto_delete" eval="True"/>
</record>

<!-- SCHOLARIX-specific groups and rules -->

<!-- SCHOLARIX Commission Analyst Group -->
<record id="group_scholarix_commission_analyst" model="res.groups">
    <field name="name">SCHOLARIX Commission Analyst</field>
    <field name="category_id" ref="base.module_category_sales"/>
    <field name="implied_ids" eval="[(4, ref('group_commission_statement_user'))]"/>
    <field name="comment">Can analyze commission data and generate reports but cannot modify commission statements</field>
</record>

<!-- SCHOLARIX Finance Team Group -->
<record id="group_scholarix_finance_team" model="res.groups">
    <field name="name">SCHOLARIX Finance Team</field>
    <field name="category_id" ref="base.module_category_accounting"/>
    <field name="implied_ids" eval="[(4, ref('group_commission_statement_manager'))]"/>
    <field name="comment">Full access to commission statements and payment processing</field>
</record>

<!-- Record Rules for SCHOLARIX Commission Statements -->

<!-- Agents can only see their own statements -->
<record id="scholarix_commission_statement_agent_rule" model="ir.rule">
    <field name="name">SCHOLARIX Commission Statement: Agent can see own statements</field>
    <field name="model_id" ref="base.model_scholarix_commission_statement"/>
    <field name="domain_force">[('agent_id.user_ids', 'in', [user.id])]</field>
    <field name="groups" eval="[(4, ref('base.group_portal')), (4, ref('base.group_user'))]"/>
    <field name="perm_read" eval="True"/>
    <field name="perm_write" eval="False"/>
    <field name="perm_create" eval="False"/>
    <field name="perm_unlink" eval="False"/>
</record>

<!-- Commission users can see all statements but limited write access -->
<record id="scholarix_commission_statement_user_rule" model="ir.rule">
    <field name="name">SCHOLARIX Commission Statement: User access</field>
    <field name="model_id" ref="base.model_scholarix_commission_statement"/>
    <field name="domain_force">[(1, '=', 1)]</field>
    <field name="groups" eval="[(4, ref('group_commission_statement_user'))]"/>
    <field name="perm_read" eval="True"/>
    <field name="perm_write" eval="True"/>
    <field name="perm_create" eval="True"/>
    <field name="perm_unlink" eval="False"/>
</record>

<!-- Commission managers have full access -->
<record id="scholarix_commission_statement_manager_rule" model="ir.rule">
    <field name="name">SCHOLARIX Commission Statement: Manager full access</field>
    <field name="model_id" ref="base.model_scholarix_commission_statement"/>
    <field name="domain_force">[(1, '=', 1)]</field>
    <field name="groups" eval="[(4, ref('group_commission_statement_manager'))]"/>
    <field name="perm_read" eval="True"/>
    <field name="perm_write" eval="True"/>
    <field name="perm_create" eval="True"/>
    <field name="perm_unlink" eval="True"/>
</record>

<!-- Commission Lines Rules -->
<record id="scholarix_commission_line_agent_rule" model="ir.rule">
    <field name="name">SCHOLARIX Commission Line: Agent can see own lines</field>
    <field name="model_id" ref="base.model_scholarix_commission_line"/>
    <field name="domain_force">[('statement_id.agent_id.user_ids', 'in', [user.id])]</field>
    <field name="groups" eval="[(4, ref('base.group_portal')), (4, ref('base.group_user'))]"/>
    <field name="perm_read" eval="True"/>
    <field name="perm_write" eval="False"/>
    <field name="perm_create" eval="False"/>
    <field name="perm_unlink" eval="False"/>
</record>

<!-- Email Template for SCHOLARIX Commission Statement -->
<record id="email_template_scholarix_commission_statement" model="mail.template">
    <field name="name">SCHOLARIX Commission Statement</field>
    <field name="model_id" ref="base.model_scholarix_commission_statement"/>
    <field name="subject">SCHOLARIX Commission Statement - ${object.agent_id.name} - ${object.period_start} to ${object.period_end}</field>
    <field name="body_html" type="html">
        <div style="font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; padding: 30px; border-radius: 10px;">
            <!-- SCHOLARIX Header -->
            <div style="background: linear-gradient(135deg, #2E86AB 0%, #A23B72 100%); color: white; padding: 25px; margin-bottom: 25px; border-radius: 8px; text-align: center;">
                <h1 style="margin: 0; font-size: 32px; font-weight: bold; letter-spacing: 2px;">SCHOLARIX</h1>
                <p style="margin: 10px 0 0 0; font-size: 18px; opacity: 0.9;">Commission Statement</p>
            </div>

            <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h2 style="color: #2E86AB; margin-bottom: 20px;">Dear ${object.agent_id.name},</h2>

                <p style="font-size: 16px; line-height: 1.6;">
                    Please find attached your commission statement for the period 
                    <strong>${object.period_start}</strong> to <strong>${object.period_end}</strong>.
                </p>

                <!-- Commission Summary -->
                <div style="background: #f8f9fa; padding: 20px; margin: 25px 0; border-left: 4px solid #2E86AB; border-radius: 5px;">
                    <h3 style="margin: 0 0 15px 0; color: #2E86AB;">Commission Summary</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="padding: 8px 0; font-weight: bold;">Total Sales:</td>
                            <td style="padding: 8px 0; text-align: right;">${format_amount(object.total_sales, object.currency_id)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px 0; font-weight: bold;">Commission Orders:</td>
                            <td style="padding: 8px 0; text-align: right;">${object.order_count}</td>
                        </tr>
                        <tr style="border-top: 2px solid #2E86AB;">
                            <td style="padding: 12px 0; font-weight: bold; font-size: 18px; color: #2E86AB;">Gross Commission:</td>
                            <td style="padding: 12px 0; text-align: right; font-weight: bold; font-size: 18px; color: #2E86AB;">${format_amount(object.gross_commission, object.currency_id)}</td>
                        </tr>
                        % if object.deductions > 0:
                        <tr>
                            <td style="padding: 8px 0; font-weight: bold;">Less: Deductions:</td>
                            <td style="padding: 8px 0; text-align: right; color: #dc3545;">-${format_amount(object.deductions, object.currency_id)}</td>
                        </tr>
                        <tr style="border-top: 1px solid #dee2e6;">
                            <td style="padding: 12px 0; font-weight: bold; font-size: 18px; color: #28a745;">Net Commission:</td>
                            <td style="padding: 12px 0; text-align: right; font-weight: bold; font-size: 18px; color: #28a745;">${format_amount(object.net_commission, object.currency_id)}</td>
                        </tr>
                        % endif
                    </table>
                </div>

                <!-- Commission Breakdown -->
                <div style="display: flex; justify-content: space-between; margin: 25px 0;">
                    <div style="text-align: center; flex: 1;">
                        <h4 style="color: #28a745; margin-bottom: 5px;">Direct Sales</h4>
                        <p style="font-size: 18px; font-weight: bold; margin: 0;">${format_amount(object.direct_sales_commission, object.currency_id)}</p>
                        <small style="color: #6c757d;">5% Commission</small>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <h4 style="color: #ffc107; margin-bottom: 5px;">Referral Bonus</h4>
                        <p style="font-size: 18px; font-weight: bold; margin: 0;">${format_amount(object.referral_bonus, object.currency_id)}</p>
                        <small style="color: #6c757d;">2% Commission</small>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <h4 style="color: #17a2b8; margin-bottom: 5px;">Team Override</h4>
                        <p style="font-size: 18px; font-weight: bold; margin: 0;">${format_amount(object.team_override, object.currency_id)}</p>
                        <small style="color: #6c757d;">1% Commission</small>
                    </div>
                </div>

                <!-- Payment Information -->
                <div style="background: #e7f3ff; border: 1px solid #2E86AB; border-radius: 5px; padding: 15px; margin: 20px 0;">
                    <h4 style="color: #2E86AB; margin-bottom: 10px;">Payment Information</h4>
                    <p style="margin: 5px 0;">
                        <strong>Status:</strong> ${object.payment_status.title()}</p>
                    <p style="margin: 5px 0;">
                        <strong>Payment Schedule:</strong> Monthly on the 15th</p>
                    <p style="margin: 5px 0;">
                        <strong>Method:</strong> Bank Transfer</p>
                </div>

                <p style="font-size: 16px; line-height: 1.6; margin-top: 25px;">
                    If you have any questions regarding this statement, please don't hesitate to contact our finance team.
                </p>

                <p style="font-size: 16px; margin-top: 25px;">
                    Best regards,<br/>
                <strong>${user.name}</strong>
                <br/>
                    ${user.company_id.name}<br/>
            <span style="color: #2E86AB; font-weight: bold;">SCHOLARIX Finance Team</span>
        </p>
    </div>
</div>
</field>
<field name="auto_delete" eval="True"/>
<field name="report_template" ref="action_scholarix_agent_statement"/>
</record>

</odoo>
