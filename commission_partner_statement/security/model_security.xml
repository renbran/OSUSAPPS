<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Model-dependent security rules - Load after models are created -->
    
    <!-- Record Rules for SCHOLARIX Commission Statements -->
    <data>
        <!-- Agents can only see their own statements -->
        <record id="scholarix_commission_statement_agent_rule" model="ir.rule">
            <field name="name">SCHOLARIX Commission Statement: Agent can see own statements</field>
            <field name="model_id" ref="base.model_scholarix_commission_statement"/>
            <field name="domain_force">[('agent_id.user_ids', 'in', [user.id])]</field>
            <field name="groups" eval="[(4, ref('base.group_portal')), (4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Commission users can see all statements but limited write access -->
        <record id="scholarix_commission_statement_user_rule" model="ir.rule">
            <field name="name">SCHOLARIX Commission Statement: User access</field>
            <field name="model_id" ref="base.model_scholarix_commission_statement"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_statement_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Commission managers have full access -->
        <record id="scholarix_commission_statement_manager_rule" model="ir.rule">
            <field name="name">SCHOLARIX Commission Statement: Manager full access</field>
            <field name="model_id" ref="base.model_scholarix_commission_statement"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_commission_statement_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Commission Lines Rules -->
        <record id="scholarix_commission_line_agent_rule" model="ir.rule">
            <field name="name">SCHOLARIX Commission Line: Agent can see own lines</field>
            <field name="model_id" ref="base.model_scholarix_commission_line"/>
            <field name="domain_force">[('statement_id.agent_id.user_ids', 'in', [user.id])]</field>
            <field name="groups" eval="[(4, ref('base.group_portal')), (4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Email Template for SCHOLARIX Commission Statement -->
        <record id="email_template_scholarix_commission_statement" model="mail.template">
            <field name="name">SCHOLARIX Commission Statement</field>
            <field name="model_id" ref="base.model_scholarix_commission_statement"/>
            <field name="subject">SCHOLARIX Commission Statement - ${object.agent_id.name} - ${object.period_start} to ${object.period_end}</field>
            <field name="body_html" type="html">
                <div style="font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; padding: 30px; border-radius: 10px;">
                    <!-- SCHOLARIX Header -->
                    <div style="background: linear-gradient(135deg, #2E86AB 0%, #A23B72 100%); color: white; padding: 25px; margin-bottom: 25px; border-radius: 8px; text-align: center;">
                        <h1 style="margin: 0; font-size: 32px; font-weight: bold; letter-spacing: 2px;">SCHOLARIX</h1>
                        <p style="margin: 10px 0 0 0; font-size: 18px; opacity: 0.9;">Commission Statement</p>
                    </div>
                    
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h2 style="color: #2E86AB; margin-bottom: 20px;">Dear ${object.agent_id.name},</h2>
                        
                        <p style="font-size: 16px; line-height: 1.6;">
                            Please find attached your SCHOLARIX commission statement for the period from 
                            <strong>${object.period_start}</strong> to <strong>${object.period_end}</strong>.
                        </p>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3 style="color: #2E86AB; margin-top: 0;">Commission Summary</h3>
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr>
                                    <td style="padding: 8px 0; border-bottom: 1px solid #dee2e6;"><strong>Total Sales:</strong></td>
                                    <td style="padding: 8px 0; border-bottom: 1px solid #dee2e6; text-align: right;">${object.total_sales} ${object.currency_id.symbol}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; border-bottom: 1px solid #dee2e6;"><strong>Direct Sales Commission:</strong></td>
                                    <td style="padding: 8px 0; border-bottom: 1px solid #dee2e6; text-align: right;">${object.direct_sales_commission} ${object.currency_id.symbol}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; border-bottom: 1px solid #dee2e6;"><strong>Referral Bonus:</strong></td>
                                    <td style="padding: 8px 0; border-bottom: 1px solid #dee2e6; text-align: right;">${object.referral_bonus} ${object.currency_id.symbol}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; border-bottom: 1px solid #dee2e6;"><strong>Team Override:</strong></td>
                                    <td style="padding: 8px 0; border-bottom: 1px solid #dee2e6; text-align: right;">${object.team_override} ${object.currency_id.symbol}</td>
                                </tr>
                                <tr style="background: #2E86AB; color: white;">
                                    <td style="padding: 12px 8px; font-weight: bold;"><strong>Total Commission:</strong></td>
                                    <td style="padding: 12px 8px; text-align: right; font-weight: bold;"><strong>${object.total_commission} ${object.currency_id.symbol}</strong></td>
                                </tr>
                            </table>
                        </div>
                        
                        <p style="font-size: 16px; line-height: 1.6;">
                            If you have any questions about this statement, please don't hesitate to contact our finance team.
                        </p>
                        
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #2E86AB;">
                            <p style="color: #6c757d; margin: 0;">
                                Best regards,<br/>
                                <strong>SCHOLARIX Finance Team</strong>
                            </p>
                        </div>
                    </div>
                </div>
            </field>
            <field name="lang">${object.agent_id.lang}</field>
            <field name="auto_delete" eval="True"/>
        </record>
    </data>
</odoo>
