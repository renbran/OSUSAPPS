?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- Internal Commission Types -->
        <record id="commission_type_agent1" model="commission.type">
            <field name="name">Primary Agent</field>
            <field name="code">agent1</field>
            <field name="category">internal</field>
            <field name="default_rate">3.0</field>
            <field name="sequence">10</field>
            <field name="description">Primary sales agent commission</field>
        </record>
        
        <record id="commission_type_agent2" model="commission.type">
            <field name="name">Secondary Agent</field>
            <field name="code">agent2</field>
            <field name="category">internal</field>
            <field name="default_rate">2.0</field>
            <field name="sequence">20</field>
            <field name="description">Secondary sales agent commission</field>
        </record>
        
        <record id="commission_type_manager" model="commission.type">
            <field name="name">Sales Manager</field>
            <field name="code">manager</field>
            <field name="category">management</field>
            <field name="default_rate">1.0</field>
            <field name="sequence">30</field>
            <field name="description">Sales manager override commission</field>
        </record>
        
        <record id="commission_type_director" model="commission.type">
            <field name="name">Sales Director</field>
            <field name="code">director</field>
            <field name="category">management</field>
            <field name="default_rate">0.5</field>
            <field name="sequence">40</field>
            <field name="description">Sales director override commission</field>
        </record>
        
        <!-- External Commission Types -->
        <record id="commission_type_broker" model="commission.type">
            <field name="name">External Broker</field>
            <field name="code">broker</field>
            <field name="category">external</field>
            <field name="default_rate">2.0</field>
            <field name="sequence">50</field>
            <field name="description">External broker commission</field>
        </record>
        
        <record id="commission_type_referrer" model="commission.type">
            <field name="name">Referrer</field>
            <field name="code">referrer</field>
            <field name="category">referral</field>
            <field name="default_rate">1.0</field>
            <field name="sequence">60</field>
            <field name="description">Referral commission</field>
        </record>
        
        <record id="commission_type_cashback" model="commission.type">
            <field name="name">Customer Cashback</field>
            <field name="code">cashback</field>
            <field name="category">referral</field>
            <field name="default_rate">0.5</field>
            <field name="sequence">70</field>
            <field name="description">Customer cashback commission</field>
        </record>
        
        <!-- Legacy Commission Types (for migration) -->
        <record id="commission_type_consultant" model="commission.type">
            <field name="name">Consultant (Legacy)</field>
            <field name="code">consultant</field>
            <field name="category">internal</field>
            <field name="default_rate">3.0</field>
            <field name="sequence">100</field>
            <field name="description">Legacy consultant commission</field>
        </record>
        
        <record id="commission_type_manager_legacy" model="commission.type">
            <field name="name">Manager (Legacy)</field>
            <field name="code">manager_legacy</field>
            <field name="category">management</field>
            <field name="default_rate">1.0</field>
            <field name="sequence">110</field>
            <field name="description">Legacy manager commission</field>
        </record>
        
        <record id="commission_type_other_external" model="commission.type">
            <field name="name">Other External</field>
            <field name="code">other_external</field>
            <field name="category">external</field>
            <field name="default_rate">1.0</field>
            <field name="sequence">80</field>
            <field name="description">Other external partner commission</field>
        </record>
        
    </data>
</odoo>

# ============================================================================
# security/ir.model.access.csv - Access Rights
# ============================================================================

id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink
access_commission_line_user,commission.line.user,model_commission_line,sales_team.group_sale_salesman,1,1,1,0
access_commission_line_manager,commission.line.manager,model_commission_line,sales_team.group_sale_manager,1,1,1,1
access_commission_line_accounting,commission.line.accounting,model_commission_line,account.group_account_user,1,1,0,0
access_commission_type_user,commission.type.user,model_commission_type,sales_team.group_sale_salesman,1,0,0,0
access_commission_type_manager,commission.type.manager,model_commission_type,sales_team.group_sale_manager,1,1,1,1
access_commission_line_wizard_user,commission.line.wizard.user,model_commission_line_wizard,sales_team.group_sale_salesman,1,1,1,1
access_commission_line_wizard_line_user,commission.line.wizard.line.user,model_commission_line_wizard_line,sales_team.group_sale_salesman,1,1,1,1
access_commission_statement_wizard_user,commission.statement.wizard.user,model_commission_statement_wizard,sales_team.group_sale_salesman,1,1,1,1
access_commission_import_wizard_manager,commission.import.wizard.manager,model_commission_import_wizard,sales_team.group_sale_manager,1,1,1,1

# ============================================================================
# security/security.xml - Security Rules
# ============================================================================

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- Commission Line Security Rules -->
        <record id="commission_line_rule_salesperson" model="ir.rule">
            <field name="name">Commission Line: Salesperson can see own commissions</field>
            <field name="model_id" ref="model_commission_line"/>
            <field name="domain_force">[('partner_id.user_ids', 'in', [user.id])]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
        </record>
        
        <record id="commission_line_rule_manager" model="ir.rule">
            <field name="name">Commission Line: Manager can see all</field>
            <field name="model_id" ref="model_commission_line"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_manager'))]"/>
        </record>
        
        <!-- Commission Type Rules -->
        <record id="commission_type_rule_all" model="ir.rule">
            <field name="name">Commission Type: All users can read</field>
            <field name="model_id" ref="model_commission_type"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
        </record>
        
    </data>
</odoo>

# ============================================================================
# views/wizard_views.xml - Wizard Views
# ============================================================================

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Commission Line Wizard Form -->
        <record id="view_commission_line_wizard_form" model="ir.ui.view">
            <field name="name">commission.line.wizard.form</field>
            <field name="model">commission.line.wizard</field>
            <field name="arch" type="xml">
                <form string="Create Commission Lines">
                    <sheet>
                        <group>
                            <field name="sale_order_id" readonly="1"/>
                        </group>
                        
                        <separator string="Commission Lines"/>
                        <field name="line_ids">
                            <tree string="Commission Lines" editable="bottom">
                                <field name="partner_id" required="1"/>
                                <field name="commission_type_id" required="1"/>
                                <field name="rate"/>
                                <field name="base_amount"/>
                                <field name="commission_amount"/>
                                <field name="notes"/>
                                <field name="currency_id" invisible="1"/>
                            </tree>
                        </field>
                    </sheet>
                    
                    <footer>
                        <button name="action_create_commission_lines" 
                                string="Create Commission Lines" 
                                type="object" 
                                class="btn-primary"/>
                        <button string="Cancel" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        
        <!-- Commission Statement Wizard Form -->
        <record id="view_commission_statement_wizard_form" model="ir.ui.view">
            <field name="name">commission.statement.wizard.form</field>
            <field name="model">commission.statement.wizard</field>
            <field name="arch" type="xml">
                <form string="Generate Commission Statement">
                    <sheet>
                        <group>
                            <group string="Filters">
                                <field name="partner_id"/>
                                <field name="date_from"/>
                                <field name="date_to"/>
                                <field name="commission_type_ids" widget="many2many_tags"/>
                                <field name="state_filter"/>
                            </group>
                            
                            <group string="Options">
                                <field name="group_by"/>
                                <field name="include_details"/>
                                <field name="format"/>
                            </group>
                        </group>
                    </sheet>
                    
                    <footer>
                        <button name="action_generate_statement" 
                                string="Generate Statement" 
                                type="object" 
                                class="btn-primary"/>
                        <button string="Cancel" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        
        <!-- Commission Import Wizard Form -->
        <record id="view_commission_import_wizard_form" model="ir.ui.view">
            <field name="name">commission.import.wizard.form</field>
            <field name="model">commission.import.wizard</field>
            <field name="arch" type="xml">
                <form string="Import Commission Data">
                    <sheet>
                        <div class="oe_title">
                            <h1>Import Existing Commission Data</h1>
                            <p>This wizard will import commission data from existing sale orders into the new commission lines structure.</p>
                        </div>
                        
                        <group>
                            <field name="date_from"/>
                            <field name="date_to"/>
                            <field name="overwrite_existing"/>
                        </group>
                        
                        <div class="alert alert-info" role="alert">
                            <h4><i class="fa fa-info-circle"/> Important Notes</h4>
                            <ul>
                                <li>This will scan all sale orders in the date range for commission data</li>
                                <li>Commission lines will be created automatically based on existing commission fields</li>
                                <li>If "Overwrite Existing" is checked, existing commission lines will be deleted and recreated</li>
                                <li>Make sure commission types are properly configured before importing</li>
                            </ul>
                        </div>
                    </sheet>
                    
                    <footer>
                        <button name="action_import_commissions" 
                                string="Import Commission Data" 
                                type="object" 
                                class="btn-primary"/>
                        <button string="Cancel" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        
        <!-- Wizard Actions -->
        <record id="action_commission_statement_wizard" model="ir.actions.act_window">
            <field name="name">Generate Commission Statement</field>
            <field name="res_model">commission.statement.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>
        
        <record id="action_commission_import_wizard" model="ir.actions.act_window">
            <field name="name">Import Commission Data</field>
            <field name="res_model">commission.import.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>
        
        <!-- Menu Items -->
        <menuitem id="menu_commission_statement_wizard" 
                  name="Generate Statements" 
                  parent="menu_commission_reports" 
                  action="action_commission_statement_wizard" 
                  sequence="10"/>
        
        <menuitem id="menu_commission_import_wizard" 
                  name="Import Legacy Data" 
                  parent="menu_commission_main" 
                  action="action_commission_import_wizard" 
                  sequence="90"
                  groups="sales_team.group_sale_manager"/>
        
    </data>
</odoo>